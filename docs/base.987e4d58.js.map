{"version":3,"sources":["theme/latex/base.js"],"names":["getVariable","el","propertyName","String","getComputedStyle","getPropertyValue","trim","processTheElements","thes","document","querySelectorAll","i","length","v","getAttribute","textContent","_vertical","tb","doc","docEl","rect","win","getClientRects","getBoundingClientRect","ownerDocument","documentElement","defaultView","pageYOffset","clientTop","offsetTop","offsetBottom","offsetBaseline","mpbaseline","querySelector","heightAboveBaseline","baseline","top","positionMarginpars","mpars","prevBottom","forEach","mpar","mpref","id","baselineref","heightAB","height","offsetHeight","Math","round","style","marginTop","max","min","optimizedResize","callbacks","running","resize","window","requestAnimationFrame","runCallbacks","setTimeout","callback","addCallback","push","add","addEventListener","completed","removeEventListener","observer","MutationObserver","observe","attributes","childList","characterData","subtree"],"mappings":"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","file":"base.987e4d58.js","sourceRoot":"../src","sourcesContent":["function getVariable(el, propertyName) {\n    return String(getComputedStyle(el).getPropertyValue('--' + propertyName)).trim();\n};\n\nfunction processTheElements() {\n    var thes = document.querySelectorAll('.the');\n    for (var i = 0; i < thes.length; i++) {\n        var v = getVariable(thes[i], thes[i].getAttribute('display-var'));\n        // only mutate if it actually changed\n        if (thes[i].textContent != v) {\n            thes[i].textContent = v;\n        }\n    }\n}\n\n\nfunction _vertical(el, tb) {\n    var doc, docEl, rect, win;\n\n    // return zero for disconnected and hidden (display: none) elements, IE <= 11 only\n    // running getBoundingClientRect() on a disconnected node in IE throws an error\n    if ( !el.getClientRects().length ) {\n        return 0;\n    }\n\n    rect = el.getBoundingClientRect();\n\n    doc = el.ownerDocument;\n    docEl = doc.documentElement;\n    win = doc.defaultView;\n\n    return rect[tb] + win.pageYOffset - docEl.clientTop;\n}\n\n\nfunction offsetTop(el) {\n    return _vertical(el, \"top\");\n}\n\nfunction offsetBottom(el) {\n    return _vertical(el, \"bottom\");\n}\n\nfunction offsetBaseline(el) {\n    var mpbaseline = el.querySelector('.mpbaseline');\n    return offsetBottom(mpbaseline);\n}\n\nfunction heightAboveBaseline(el) {\n    var baseline = offsetBaseline(el);\n    var top = offsetTop(el);\n    return baseline - top;\n}\n\n\nfunction positionMarginpars() {\n    var mpars = document.querySelectorAll('.marginpar > div');\n    var prevBottom = 0;\n\n    mpars.forEach(function(mpar) {\n        var mpref = document.querySelector('.body #marginref-' + mpar.id);\n\n        var baselineref = offsetBottom(mpref);\n        var heightAB = heightAboveBaseline(mpar);\n        var height = mpar.offsetHeight;\n\n        // round to 1 digit\n        var top = Math.round((baselineref - heightAB - prevBottom) * 10) / 10;\n\n        // only mutate if it actually changed\n        if (mpar.style.marginTop != Math.max(0, top) + \"px\") {\n            mpar.style.marginTop = Math.max(0, top) + \"px\";\n        }\n\n        // if marginTop would have been negative, the element is now further down by that offset => add it to prevBottom\n        prevBottom = baselineref - heightAB + height - Math.min(0, top);\n    });\n}\n\n\n\n// don't call resize event handlers too often\nvar optimizedResize = (function() {\n    var callbacks = [],\n        running = false;\n\n    // fired on resize event\n    function resize() {\n        if (!running) {\n            running = true;\n\n            if (window.requestAnimationFrame) {\n                window.requestAnimationFrame(runCallbacks);\n            } else {\n                setTimeout(runCallbacks, 66);\n            }\n        }\n    }\n\n    // run the actual callbacks\n    function runCallbacks() {\n        callbacks.forEach(function(callback) { callback(); });\n        running = false;\n    }\n\n    // adds callback to loop\n    function addCallback(callback) {\n        if (callback) {\n            callbacks.push(callback);\n        }\n    }\n\n    return {\n        // public method to add additional callback\n        add: function(callback) {\n            if (!callbacks.length) {\n                window.addEventListener('resize', resize);\n            }\n            addCallback(callback);\n        }\n    }\n}());\n\n\n// setup event listeners\n\nfunction completed() {\n    document.removeEventListener(\"DOMContentLoaded\", completed);\n\twindow.removeEventListener(\"load\", positionMarginpars);\n\n    var observer = new MutationObserver(function() {\n        processTheElements();\n        positionMarginpars();\n    });\n\n    observer.observe(document, { attributes: true, childList: true, characterData: true, subtree: true });\n\n    // add resize event listener\n    optimizedResize.add(positionMarginpars);\n\n    processTheElements();\n    positionMarginpars();\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", completed);\nwindow.addEventListener(\"load\", completed);\n"]}